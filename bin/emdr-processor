#!/usr/bin/env python
"""
Shell command for starting up a processor that pulls jobs from the broker,
does some work on the data, then sends it to the relay.
"""
import argparse
from src.conf import default_settings

parser = argparse.ArgumentParser(
    description="The processor connects to the broker, and retrieves raw " \
                "order data that needs looking over. Once the data has been " \
                "processed, it is sent out to the relay.",
)
parser.add_argument(
    '--broker', action='append', dest='brokers',
    help="Overrides default processor receiver bindings. This determines where " \
         "the processor gets its messages, typically the broker.")
parser.add_argument(
    '--relay', action='append', dest='relays',
    help="Override default processor sender bindings. This determines where " \
         "the processor sends its refined data.")

parsed = parser.parse_args()

if parsed.brokers:
    print("* Overriding default processor receiver bindings.")
    default_settings.PROCESSOR_RECEIVER_BINDINGS = parsed.brokers
if parsed.relays:
    print("* Overriding default broker sender bindings.")
    default_settings.PROCESSOR_SENDER_BINDINGS = parsed.listeners

# Importing this starts the processor.
from src.daemons.processor import main